<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <script src="../../lib/jquery.js"></script>
    <link href="../../style/global.css" rel="stylesheet" />
    <link href="../../style/signin.css" rel="stylesheet" />
    <style>
        .bgimg {
            background-image: url('../../pics/background/cactus.jpg');
        }
    </style>
    <script>
        function passwordToggle() {
            var x = document.getElementById("user_password");
            if (x.type === "password") {
                x.type = "text";
            } else {
                x.type = "password";
            }
        }
    </script>
</head>

<body dir="rtl">
    <div class="bgimg w3-display-container w3-animate-opacity w3-text-white">
        <div class="w3-display-topleft w3-padding-large w3-xlarge">
            שולחן משחקים שיתופי
        </div>
        <div class="form-box w3-display-middle">
            <h1>התחברות הורה</h1>

            <div class="input-box">
                <i class="fa fa-user"></i>
                <input type="text" id="user_id" placeholder="תעודת זהות" />
            </div>

            <div class="input-box">
                <i class="fa fa-key"></i>
                <input type="password" placeholder="סיסמא" id="user_password" />
                <span class="eye" onclick="passwordToggle()">
                    <i id="hide1" class="fa fa-eye"></i>
                    <i id="hide2" class="fa fa-eye-slash"></i>
                </span>
            </div>
            <div id="err_text"></div>

            <button type="button" class="login-btn" id="login">כניסה</button>

            <div>
                <button type="button" class="new-user-btn" id="register">משתמש חדש?</button>
                <button type="button" class="homeBtn" id="btn_goToHome">
                    <img id="homeImg" src="../../pics/homeBtn.png" alt="">
                </button>
            </div>

        </div>

        <div class="w3-display-bottomleft w3-padding-large">
            Make Learning Fun
        </div>
    </div>

    <script type="module" src="api.js"></script>
    <script type="module" src="consts.js"></script>
    <script type="module">
        import { userLoginRequest } from './api.js';
        import { URL } from './consts.js';

        $(document).ready(() => {
            console.log('jquery work');
            init();
        });

        function init() {
            $('#login').on('click', () => {
                console.log('work btn');
                let userId = $("#user_id").val();
                let userPassword = $("#user_password").val();
                userLoginRequest(userId, userPassword, loginSuccess, printErrorToUser);
            });

            $('#register').on('click', () => {
                window.location.href = URL.PARENT_REGISTER;
            });

            $('#btn_goToHome').on('click', () => {
                window.location.href = URL.HOME;
            });
        }

        function loginSuccess(parent) {
            // console.log(user);
            // localStorage.setItem('parent_id', parent._id);
            localStorage.setItem('parent', JSON.stringify(parent));
            // location.replace(URL.PARENT_HOME);
            window.location.href = URL.PARENT_HOME;
        }

        function printErrorToUser(code, err) {
            $('#err_text').text(err);
        }
    </script>
</body>

</html>